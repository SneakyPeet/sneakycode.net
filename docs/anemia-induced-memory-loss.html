<!DOCTYPE html>

<html></html><html class="has-navbar-fixed-top"><head><meta charset="utf-8" content="text/html" /><meta content="width=device-width, initial-scale=1" name="viewport" /><link href="https://sneakypeet.github.io/sneakycode.net/anemia-induced-memory-loss" rel="canonnical" /><link href="https://sneakypeet.github.io/sneakycode.net/rss/" rel="alternative" title="SneakyCode" type="application/rss+xml" /><title>Anemia induced memory loss</title><meta content="Pieter Koornhof" name="author" /><link href="https://sneakypeet.github.io/sneakycode.net/apple-icon-57x57.png" rel="apple-touch-icon" sizes="57x57" /><link href="https://sneakypeet.github.io/sneakycode.net/apple-icon-60x60.png" rel="apple-touch-icon" sizes="60x60" /><link href="https://sneakypeet.github.io/sneakycode.net/apple-icon-72x72.png" rel="apple-touch-icon" sizes="72x72" /><link href="https://sneakypeet.github.io/sneakycode.net/apple-icon-76x76.png" rel="apple-touch-icon" sizes="76x76" /><link href="https://sneakypeet.github.io/sneakycode.net/apple-icon-114x114.png" rel="apple-touch-icon" sizes="114x114" /><link href="https://sneakypeet.github.io/sneakycode.net/apple-icon-120x120.png" rel="apple-touch-icon" sizes="120x120" /><link href="https://sneakypeet.github.io/sneakycode.net/apple-icon-144x144.png" rel="apple-touch-icon" sizes="144x144" /><link href="https://sneakypeet.github.io/sneakycode.net/apple-icon-152x152.png" rel="apple-touch-icon" sizes="152x152" /><link href="https://sneakypeet.github.io/sneakycode.net/apple-icon-180x180.png" rel="apple-touch-icon" sizes="180x180" /><link href="https://sneakypeet.github.io/sneakycode.net/android-icon-192x192.png" rel="icon" sizes="192x192" type="image/png" /><link href="https://sneakypeet.github.io/sneakycode.net/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png" /><link href="https://sneakypeet.github.io/sneakycode.net/favicon-96x96.png" rel="icon" sizes="96x96" type="image/png" /><link href="https://sneakypeet.github.io/sneakycode.net/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png" /><link href="https://sneakypeet.github.io/sneakycode.net/manifest.json" rel="manifest" /><meta content="#ffffff" name="msapplication-TileColor" /><meta content="ms-icon-144x144.png" name="msapplication-TileImage" /><meta content="#ffffff" name="theme-color" /><meta content="SneakyCode" property="og:site_name" /><meta content="article" property="og:type" /><meta content="Anemia induced memory loss" property="og:title" /><meta property="og:description" /><meta content="https://sneakypeet.github.io/sneakycode.net/anemia-induced-memory-loss" property="og:url" /><meta content="domain driven design" property="article:tag" /><meta content="ddd" property="article:tag" /><meta content="aggregates" property="article:tag" /><meta content="anemic domain" property="article:tag" /><meta content="rich domain" property="article:tag" /><link href="https://sneakypeet.github.io/sneakycode.net/style.css" rel="stylesheet" /><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" /></head><body><nav class="navbar is-fixed-top is-dark has-gradient" role="navigation"><div class="navbar-brand"><a class="navbar-item has-text-weight-bold" href="https://sneakypeet.github.io/sneakycode.net/">sneakycode</a></div></nav><nav aria-label="main navigation" class="navbar is-fixed-bottom is-dark has-gradient" role="navigation"><div class="navbar-brand"><a aria-label="home" class="navbar-item" href="https://sneakypeet.github.io/sneakycode.net/"><span class="icon"><i class="fa fa-lg fa-bath"></i></span></a><a aria-label="history" class="navbar-item" href="https://sneakypeet.github.io/sneakycode.net/all-posts"><span class="icon"><i class="fa fa-lg fa-history"></i></span></a><a aria-label="tags" class="navbar-item" href="https://sneakypeet.github.io/sneakycode.net/tags"><span class="icon"><i class="fa fa-lg fa-tags"></i></span></a><a aria-label="rss" class="navbar-item" href="https://sneakypeet.github.io/sneakycode.net/rss"><span class="icon"><i class="fa fa-lg fa-rss"></i></span></a><a aria-label="github" class="navbar-item" href="https://github.com/sneakypeet" target="_blank"><span class="icon"><i class="fa fa-lg fa-github"></i></span></a><a aria-label="twitter " class="navbar-item" href="https://twitter.com/PieterKoornhof" target="_blank"><span class="icon"><i class="fa fa-lg fa-twitter"></i></span></a></div></nav><div class="section"><div class="container"><div class="columns is-8 is-variable is-desktop"><article class="column is-three-quarters-desktop"><h1 class="title has-text-weight-light">Anemia induced memory loss</h1><p class="subtitle is-6"><span class="tags"><span class="tag is-primary">2015-04-16</span><a class="tag" href="https://sneakypeet.github.io/sneakycode.net/tag/aggregates">aggregates</a><a class="tag" href="https://sneakypeet.github.io/sneakycode.net/tag/anemic domain">anemic domain</a><a class="tag" href="https://sneakypeet.github.io/sneakycode.net/tag/ddd">ddd</a><a class="tag" href="https://sneakypeet.github.io/sneakycode.net/tag/domain driven design">domain driven design</a><a class="tag" href="https://sneakypeet.github.io/sneakycode.net/tag/rich domain">rich domain</a></span></p><div class="has-text-justified"><p>I have been reading <a href="https://vaughnvernon.co/?page_id=168">Implementing Domain Driven Design</a> by Vaughn Vernon. In it he mentions the concept of Anemia induced memory loss. Say what? Basically an anemic domain is a domain that lacks information about itself. All of its information lives in other places(like services). For you to learn about the domain, you have to know where to go look. This usually also requires some context about the decisions that the developer that wrote that piece of functionality made. As time goes by, this context gets lost, meaning all those details you had to know is either hard to find or completely lost. There is no one place to find the context thus you have to look everywhere. This is what anemia induced memory loss means.</p><p>DDD combats this by focusing on a rich domain. A domain that knows everything about itself. The domain no longer asks the questions, it provides the answers. If you need to know something about something, you go to that something and find it out. To achieve this however, is not an easy skill to learn. We need to learn to model a domain that makes sense to both developers and domain experts. Ubiquitous language and aggregates are the key. However it takes time and practice and guidance to really become a modeling master. </p><p>Luckily we have a new initiative at our company called <a href="http://www.entelect.co.za/">Entelect</a> Dojo, and my buddy <a href="https://twitter.com/eldevilliers">Eugene</a> and myself gave a talk on domain driven design and how to start thinking "rich domain". We had a nice comparison of a domain implemented using <a href="http://martinfowler.com/eaaCatalog/transactionScript.html">transaction script</a>(aka anemic domain) and a rich domain model. The Anemia induced memory loss is blatantly obvious so I thought I would run through the two examples. This will also give you a sense of how to start thinking rich domain.</p><p>___</p><h3>First we need some requirements.</h3>
<ul>
  <li>Employees can capture Annual and Study leave.</li>
  <li>There are various rules around capturing leave.</li>
</ul><p>___</p><h3>Anemic Domain</h3><p>Typically we will have a <code>LeaveEntry</code> poco that we use everywhere. We might also have a <code>LeaveService</code> that is responsible for control flow (mapping, validation, persistence) and business rules.</p>
<pre class="syntax"><code class="csharp"><span></span><span class="k">public</span> <span class="k">enum</span> <span class="n">LeaveType</span>
<span class="p">{</span>
    <span class="n">Annual</span><span class="p">,</span>
    <span class="n">Study</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">LeaveEntry</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nf">LeaveEntry</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="n">Approvers</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Employee</span><span class="p">&gt;();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="kt">int</span> <span class="n">EmployeeId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="k">public</span> <span class="n">DateTime</span> <span class="n">StartDate</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="k">public</span> <span class="n">DateTime</span> <span class="n">EndDate</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="k">public</span> <span class="n">LeaveType</span> <span class="n">LeaveType</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="k">public</span> <span class="n">LeaveStatus</span> <span class="n">LeaveStatus</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Employee</span><span class="p">&gt;</span> <span class="n">Approvers</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">private</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="k">public</span> <span class="n">Employee</span> <span class="n">CurrentApprover</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre><p>Lets assume that the business called and added the following requirements.</p>
<ul>
  <li>There is a new Sick Leave Type</li>
  <li>Sick leave can only be assigned if a sick note is attached</li>
</ul><p>We might change our <code>LeaveEntry</code> as follows</p>
<pre class="syntax"><code class="csharp"><span></span><span class="k">public</span> <span class="k">enum</span> <span class="n">LeaveType</span>
<span class="p">{</span>
    <span class="n">Annual</span><span class="p">,</span>
    <span class="n">Study</span><span class="p">,</span>
    <span class="n">Sick</span> <span class="c1">//Change</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">LeaveEntry</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nf">LeaveEntry</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="n">Approvers</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Employee</span><span class="p">&gt;();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="kt">int</span> <span class="n">EmployeeId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="k">public</span> <span class="n">DateTime</span> <span class="n">StartDate</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="k">public</span> <span class="n">DateTime</span> <span class="n">EndDate</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="k">public</span> <span class="n">LeaveType</span> <span class="n">LeaveType</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="k">public</span> <span class="n">LeaveStatus</span> <span class="n">LeaveStatus</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Employee</span><span class="p">&gt;</span> <span class="n">Approvers</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">private</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="k">public</span> <span class="n">Employee</span> <span class="n">CurrentApprover</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

	<span class="k">public</span> <span class="kt">byte</span><span class="p">[]</span> <span class="n">Document</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span> <span class="c1">//Change</span>
<span class="p">}</span>
</code></pre><p>Can you spot the Anemia induced memory loss? Let's say a new team member joins and the first thing he sees is the <code>LeaveEntry</code> class. What is he going to think? All leave entries requires a document? He will be wrong ofcourse, but there is nothing here that points at that rule. If he does not know about the rule, he will not know to go and look for it elsewhere. This is the trap that an anemic domain sets.</p><p>___ In a rich domain we would stick with the <code>LeaveEntry</code> as our aggregateroot. But we would move all the business rules out of our <code>LeaveService</code> into our <code>LeaveEntry</code>. We would then also decide to either make <code>LeaveEntry</code> a base class and have our <code>LeaveTypes</code> inherit from it, or compose our <code>LeaveEntry</code> with a <code>LeaveType</code> (you do this typically if the type can change). Our document will only live on our <code>SickLeaveType</code> and we will also find the validation on that type. Thus the rules and intent around sick leave is clear and complete and in one place.</p><p>Please jump over to <a href="https://github.com/entelect/Dojo_DomainDrivenDesign">github</a> and have a look at this example with more rules and coded examples for both anemic and rich domain. Note that how any change in the rich domain models, have no impact on control flow. This is great because it means we can only write tests for our new classes. Also note how easy it is to test our rules without having to mock anything. This is the beauty of a rich domain.</p><p>You might notice that the Rich Domain is a bit more complex and not really less code. Modeling and modeling well is hard. But the reward can be massive.</p><p>That said there is nothing wrong with transaction script and it has its place, just like there are problems to which DDD is not the right solution. But if you tend to have more than a few rules, DDD starts to shine.</p><p><a href="http://www.codeproject.com/script/Articles/BlogFeedList.aspx?amid=8804440" rel="tag" style="display:none">CodeProject</a></p></div></article><div aria-label="pagination" class="column" role="navigation"><div class="short-timeline"><div class="timeline is-rtl"><div class="timeline-header"><a class="tag is-primary" href="https://sneakypeet.github.io/sneakycode.net/aggregates-and-persistence">Older</a></div><div class="timeline-item"><div class="timeline-marker"></div><div class="timeline-content"><a class="header" href="https://sneakypeet.github.io/sneakycode.net/aggregates-and-persistence">Aggregates and Persistence</a></div></div><div class="timeline-header"><a class="tag is-primary" href="https://sneakypeet.github.io/sneakycode.net/how-changing-my-commit-messages-made-me-more-productive">Newer</a></div><div class="timeline-item"><div class="timeline-marker"></div><div class="timeline-content"><a class="header" href="https://sneakypeet.github.io/sneakycode.net/how-changing-my-commit-messages-made-me-more-productive">How changing my commit messages made me more productive</a></div></div><div class="timeline-header"><a class="tag is-primary" href="https://sneakypeet.github.io/sneakycode.net/tag/ddd">ddd</a></div><div class="timeline-item"><div class="timeline-marker"></div><div class="timeline-content"><a class="header" href="https://sneakypeet.github.io/sneakycode.net/what-language-does-your-application-speak">What Language Does Your Application Speak</a></div></div><div class="timeline-item"><div class="timeline-marker"></div><div class="timeline-content"><a class="header" href="https://sneakypeet.github.io/sneakycode.net/reflecting-on-domain-driven-design">Reflecting on Domain Driven Design</a></div></div><div class="timeline-item"><div class="timeline-marker"></div><div class="timeline-content"><a class="header" href="https://sneakypeet.github.io/sneakycode.net/aggregates-and-persistence">Aggregates and Persistence</a></div></div><div class="timeline-item"><div class="timeline-marker"></div><div class="timeline-content"><a class="header" href="https://sneakypeet.github.io/sneakycode.net/getting-wooed-by-fsharp">Getting wooed by F#</a></div></div><div class="timeline-item"><div class="timeline-marker"></div><div class="timeline-content"><a class="header" href="https://sneakypeet.github.io/sneakycode.net/modeling-with-aggregates">Modeling with Aggregates</a></div></div><div class="timeline-item"><div class="timeline-marker"></div><div class="timeline-content"><a class="header" href="https://sneakypeet.github.io/sneakycode.net/make-those-value-objects-work-for-you">Make Those Value Objects Work For You</a></div></div><div class="timeline-item"><div class="timeline-marker"></div><div class="timeline-content"><a class="header" href="https://sneakypeet.github.io/sneakycode.net/value-objects">Value Objects</a></div></div><div class="timeline-item"><div class="timeline-marker"></div><div class="timeline-content"><a class="header" href="https://sneakypeet.github.io/sneakycode.net/domain-driven-design-app-structure-part-2">Domain Driven Design App Structure part 2</a></div></div><div class="timeline-item"><div class="timeline-marker"></div><div class="timeline-content"><a class="header" href="https://sneakypeet.github.io/sneakycode.net/domain-driven-design-app-structure">Domain Driven Design App Structure</a></div></div><div class="timeline-item"><div class="timeline-marker"></div><div class="timeline-content"><a class="header" href="https://sneakypeet.github.io/sneakycode.net/intro-to-practical-domain-driven-design">Introduction To Practical Domain Driven Design</a></div></div><div class="timeline-header"><a class="tag is-primary" href="https://sneakypeet.github.io/sneakycode.net/tag/aggregates">aggregates</a></div><div class="timeline-item"><div class="timeline-marker"></div><div class="timeline-content"><a class="header" href="https://sneakypeet.github.io/sneakycode.net/aggregates-and-persistence">Aggregates and Persistence</a></div></div><div class="timeline-item"><div class="timeline-marker"></div><div class="timeline-content"><a class="header" href="https://sneakypeet.github.io/sneakycode.net/modeling-with-aggregates">Modeling with Aggregates</a></div></div><div class="timeline-header"><span class="tag is-primary">end</span></div></div></div></div></div></div></div></body></html>