<!DOCTYPE html>

<html></html><html class="has-navbar-fixed-top"><head><meta charset="utf-8" content="text/html" /><meta content="width=device-width, initial-scale=1" name="viewport" /><link href="https://sneakypeet.github.io/sneakycode.net/make-those-value-objects-work-for-you" rel="canonnical" /><link href="https://sneakypeet.github.io/sneakycode.net/rss/" rel="alternative" title="SneakyCode" type="application/rss+xml" /><title>Make Those Value Objects Work For You</title><meta content="Pieter Koornhof" name="author" /><link href="https://sneakypeet.github.io/sneakycode.net/apple-icon-57x57.png" rel="apple-touch-icon" sizes="57x57" /><link href="https://sneakypeet.github.io/sneakycode.net/apple-icon-60x60.png" rel="apple-touch-icon" sizes="60x60" /><link href="https://sneakypeet.github.io/sneakycode.net/apple-icon-72x72.png" rel="apple-touch-icon" sizes="72x72" /><link href="https://sneakypeet.github.io/sneakycode.net/apple-icon-76x76.png" rel="apple-touch-icon" sizes="76x76" /><link href="https://sneakypeet.github.io/sneakycode.net/apple-icon-114x114.png" rel="apple-touch-icon" sizes="114x114" /><link href="https://sneakypeet.github.io/sneakycode.net/apple-icon-120x120.png" rel="apple-touch-icon" sizes="120x120" /><link href="https://sneakypeet.github.io/sneakycode.net/apple-icon-144x144.png" rel="apple-touch-icon" sizes="144x144" /><link href="https://sneakypeet.github.io/sneakycode.net/apple-icon-152x152.png" rel="apple-touch-icon" sizes="152x152" /><link href="https://sneakypeet.github.io/sneakycode.net/apple-icon-180x180.png" rel="apple-touch-icon" sizes="180x180" /><link href="https://sneakypeet.github.io/sneakycode.net/android-icon-192x192.png" rel="icon" sizes="192x192" type="image/png" /><link href="https://sneakypeet.github.io/sneakycode.net/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png" /><link href="https://sneakypeet.github.io/sneakycode.net/favicon-96x96.png" rel="icon" sizes="96x96" type="image/png" /><link href="https://sneakypeet.github.io/sneakycode.net/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png" /><link href="https://sneakypeet.github.io/sneakycode.net/manifest.json" rel="manifest" /><meta content="#ffffff" name="msapplication-TileColor" /><meta content="ms-icon-144x144.png" name="msapplication-TileImage" /><meta content="#ffffff" name="theme-color" /><meta content="SneakyCode" property="og:site_name" /><meta content="article" property="og:type" /><meta content="Make Those Value Objects Work For You" property="og:title" /><meta property="og:description" /><meta content="https://sneakypeet.github.io/sneakycode.net/make-those-value-objects-work-for-you" property="og:url" /><meta content="domain driven design" property="article:tag" /><meta content="ddd" property="article:tag" /><meta content="value objects" property="article:tag" /><meta content="immutability" property="article:tag" /><link href="https://sneakypeet.github.io/sneakycode.net/style.css" rel="stylesheet" /><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" /></head><body><nav class="navbar is-fixed-top is-dark has-gradient" role="navigation"><div class="navbar-brand"><a class="navbar-item has-text-weight-bold" href="https://sneakypeet.github.io/sneakycode.net/">sneakycode</a></div></nav><nav aria-label="main navigation" class="navbar is-fixed-bottom is-dark has-gradient" role="navigation"><div class="navbar-brand"><a aria-label="home" class="navbar-item" href="https://sneakypeet.github.io/sneakycode.net/"><span class="icon"><i class="fa fa-lg fa-bath"></i></span></a><a aria-label="history" class="navbar-item" href="https://sneakypeet.github.io/sneakycode.net/all-posts"><span class="icon"><i class="fa fa-lg fa-history"></i></span></a><a aria-label="tags" class="navbar-item" href="https://sneakypeet.github.io/sneakycode.net/tags"><span class="icon"><i class="fa fa-lg fa-tags"></i></span></a><a aria-label="rss" class="navbar-item" href="https://sneakypeet.github.io/sneakycode.net/rss.rss"><span class="icon"><i class="fa fa-lg fa-rss"></i></span></a><a aria-label="github" class="navbar-item" href="https://github.com/sneakypeet" target="_blank"><span class="icon"><i class="fa fa-lg fa-github"></i></span></a><a aria-label="twitter " class="navbar-item" href="https://twitter.com/PieterKoornhof" target="_blank"><span class="icon"><i class="fa fa-lg fa-twitter"></i></span></a></div></nav><div class="section"><div class="container"><div class="columns is-8 is-variable is-desktop"><article class="column is-three-quarters-desktop"><h1 class="title has-text-weight-light">Make Those Value Objects Work For You</h1><p class="subtitle is-6 post-tags"><span class="tags"><span class="tag is-primary tag-lite">2015-02-18</span><a class="tag" href="https://sneakypeet.github.io/sneakycode.net/tag/ddd">ddd</a><a class="tag" href="https://sneakypeet.github.io/sneakycode.net/tag/domain-driven-design">domain driven design</a><a class="tag" href="https://sneakypeet.github.io/sneakycode.net/tag/immutability">immutability</a><a class="tag" href="https://sneakypeet.github.io/sneakycode.net/tag/value-objects">value objects</a></span></p><div class="has-text-justified content"><p>We can have value objects be more than just information carriers. We can have them do some work for us.</p><p><strong>A Scenario</strong></p><p>Given a contract and some time sheet data for an employee we need to calculate invoice lines for billing a client.</p><p>We can use an object called an InvoiceLineCalculator to calculate the resulting invoice lines. Even though an object like this feels different from the <a href="http://sneakycode.net/value-objects/">ValueObjects we talked about previously</a>, I am going to argue that it can in fact be a ValueObject if we follow these rules:</p>
<ul>
  <li>It can be identified by the value of its outputs</li>
  <li>It is immutable</li>
</ul><p>The calculated invoice lines should always be the same given the same calculator input data, thus satisfying the first rule.</p><p>We satisfy immutability by enforcing two things:</p>
<ul>
  <li>After calculation we should not be able to change the output values of the calculator. We achieve this by using private setters and concepts like IReadonlyList<T>.</T></li>
  <li>We should also not keep references to input data. Even though we might pass complex objects to the calculator via its constructor, we should not keep references to these objects. Firstly we might not want to keep these objects around as long as our calculator. Secondly if we keep references around we run the risk of depending on these references in our output, thus if another object changes values on our reference object, it might cause changes to our ValueObject output, breaking immutability.</li>
</ul><p><strong>But can't we just use a Domain Service?</strong></p><p>Short answer, yes! Long answer, it depends. For the simple example above it might make sense to just have a domain service with a calculate method that returns the invoice lines. But let's say there are multiple contract types, each with its own invoicing rules. Furthermore we might expect to be provided with other data regarding the calculation. This would mean our service has to know the calculations for all the different contract types. The service will soon become cluttered with details of each calculation.</p><p>Below is an example of an InvoiceLineCalculator as a ValueObject.</p>
<pre class="syntax"><code class="csharp"><span></span><span class="k">public</span> <span class="k">class</span> <span class="nc">WeeklyRetainerLineCalculator</span> <span class="p">:</span> <span class="n">IInvoiceLineCalculator</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">bool</span> <span class="n">ShouldInvoice</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">private</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="n">IReadOnlyList</span><span class="p">&lt;</span><span class="n">InvoiceLine</span><span class="p">&gt;</span> <span class="n">InvoiceLines</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">private</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

	<span class="k">public</span> <span class="nf">WeeklyRetainerLineCalculator</span><span class="p">(</span><span class="n">Retainer</span> <span class="n">retainer</span><span class="p">,</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Timesheet</span><span class="p">&gt;</span> <span class="n">timesheets</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Calculate</span><span class="p">(</span><span class="n">retainer</span><span class="p">,</span> <span class="n">timesheets</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">void</span> <span class="nf">Calculate</span><span class="p">(</span><span class="n">Retainer</span> <span class="n">retainer</span><span class="p">,</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Timesheet</span><span class="p">&gt;</span> <span class="n">timesheets</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//calculate invoice lines</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre><p>Having a single object per contract type proves to be cleaner. Note the immutability. Note the single responsibility. We will typically use a factory to construct our different calculator types based on input values. This means that when we need to add another contract/calculator type, we do not have to edit any control flow. We just add the decision line in our factory and implement the new calculator. Polymorph much?</p><p>Another great side effect of the above code is that it is easily testable and if needed the class can be removed with very little side effects. It is of course very important to name these classes well, to make the intent clear.</p><p><strong>But Why</strong></p><p>The most important thing to take away from this post is that immutability is your friend. When you set out to write immutable objects, intent stays clear, side-effects are limited and ultimately bugs are avoided.</p><p><a href="http://www.codeproject.com/script/Articles/BlogFeedList.aspx?amid=8804440" rel="tag" style="display:none">CodeProject</a></p></div></article><div aria-label="pagination" class="column" role="navigation"><div class="short-timeline"><div class="timeline is-rtl"><div class="timeline-header"><a class="tag is-primary tag-lite" href="https://sneakypeet.github.io/sneakycode.net/value-objects">Older</a></div><div class="timeline-item"><div class="timeline-marker"></div><div class="timeline-content"><a class="header" href="https://sneakypeet.github.io/sneakycode.net/value-objects">Value Objects</a></div></div><div class="timeline-header"><a class="tag is-primary tag-lite" href="https://sneakypeet.github.io/sneakycode.net/getting-started-with-chat-ops">Newer</a></div><div class="timeline-item"><div class="timeline-marker"></div><div class="timeline-content"><a class="header" href="https://sneakypeet.github.io/sneakycode.net/getting-started-with-chat-ops">Getting Started With Chat Ops</a></div></div><div class="timeline-header"><a class="tag is-primary tag-lite" href="https://sneakypeet.github.io/sneakycode.net/tag/ddd">ddd</a></div><div class="timeline-item"><div class="timeline-marker"></div><div class="timeline-content"><a class="header" href="https://sneakypeet.github.io/sneakycode.net/what-language-does-your-application-speak">What Language Does Your Application Speak</a></div></div><div class="timeline-item"><div class="timeline-marker"></div><div class="timeline-content"><a class="header" href="https://sneakypeet.github.io/sneakycode.net/reflecting-on-domain-driven-design">Reflecting on Domain Driven Design</a></div></div><div class="timeline-item"><div class="timeline-marker"></div><div class="timeline-content"><a class="header" href="https://sneakypeet.github.io/sneakycode.net/anemia-induced-memory-loss">Anemia induced memory loss</a></div></div><div class="timeline-item"><div class="timeline-marker"></div><div class="timeline-content"><a class="header" href="https://sneakypeet.github.io/sneakycode.net/aggregates-and-persistence">Aggregates and Persistence</a></div></div><div class="timeline-item"><div class="timeline-marker"></div><div class="timeline-content"><a class="header" href="https://sneakypeet.github.io/sneakycode.net/getting-wooed-by-fsharp">Getting wooed by F#</a></div></div><div class="timeline-item"><div class="timeline-marker"></div><div class="timeline-content"><a class="header" href="https://sneakypeet.github.io/sneakycode.net/modeling-with-aggregates">Modeling with Aggregates</a></div></div><div class="timeline-item"><div class="timeline-marker"></div><div class="timeline-content"><a class="header" href="https://sneakypeet.github.io/sneakycode.net/value-objects">Value Objects</a></div></div><div class="timeline-item"><div class="timeline-marker"></div><div class="timeline-content"><a class="header" href="https://sneakypeet.github.io/sneakycode.net/domain-driven-design-app-structure-part-2">Domain Driven Design App Structure part 2</a></div></div><div class="timeline-item"><div class="timeline-marker"></div><div class="timeline-content"><a class="header" href="https://sneakypeet.github.io/sneakycode.net/domain-driven-design-app-structure">Domain Driven Design App Structure</a></div></div><div class="timeline-item"><div class="timeline-marker"></div><div class="timeline-content"><a class="header" href="https://sneakypeet.github.io/sneakycode.net/intro-to-practical-domain-driven-design">Introduction To Practical Domain Driven Design</a></div></div><div class="timeline-header"><a class="tag is-primary tag-lite" href="https://sneakypeet.github.io/sneakycode.net/tag/immutability">immutability</a></div><div class="timeline-item"><div class="timeline-marker"></div><div class="timeline-content"><a class="header" href="https://sneakypeet.github.io/sneakycode.net/value-objects">Value Objects</a></div></div><div class="timeline-header"><span class="tag is-primary tag-lite">end</span></div></div></div></div></div></div></div></body></html>