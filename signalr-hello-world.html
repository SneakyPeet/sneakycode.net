<!DOCTYPE html>

<html></html><html class="has-navbar-fixed-top"><head><script async="async" src="https://www.googletagmanager.com/gtag/js?id=UA-58216004-1"></script><script>window.dataLayer = window.dataLayer || [];
                 function gtag(){dataLayer.push(arguments);}
                 gtag('js', new Date());
                 gtag('config', 'UA-58216004-1');</script><meta charset="utf-8" content="text/html" /><meta content="width=device-width, initial-scale=1" name="viewport" /><link href="https://sneakycode.net/signalr-hello-world" rel="canonnical" /><link href="https://sneakycode.net/rss/" rel="alternative" title="SneakyCode" type="application/rss+xml" /><title>SignalR Hello World (That is not a chat app)</title><meta content="Pieter Koornhof" name="author" /><link href="https://sneakycode.net/apple-icon-57x57.png" rel="apple-touch-icon" sizes="57x57" /><link href="https://sneakycode.net/apple-icon-60x60.png" rel="apple-touch-icon" sizes="60x60" /><link href="https://sneakycode.net/apple-icon-72x72.png" rel="apple-touch-icon" sizes="72x72" /><link href="https://sneakycode.net/apple-icon-76x76.png" rel="apple-touch-icon" sizes="76x76" /><link href="https://sneakycode.net/apple-icon-114x114.png" rel="apple-touch-icon" sizes="114x114" /><link href="https://sneakycode.net/apple-icon-120x120.png" rel="apple-touch-icon" sizes="120x120" /><link href="https://sneakycode.net/apple-icon-144x144.png" rel="apple-touch-icon" sizes="144x144" /><link href="https://sneakycode.net/apple-icon-152x152.png" rel="apple-touch-icon" sizes="152x152" /><link href="https://sneakycode.net/apple-icon-180x180.png" rel="apple-touch-icon" sizes="180x180" /><link href="https://sneakycode.net/android-icon-192x192.png" rel="icon" sizes="192x192" type="image/png" /><link href="https://sneakycode.net/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png" /><link href="https://sneakycode.net/favicon-96x96.png" rel="icon" sizes="96x96" type="image/png" /><link href="https://sneakycode.net/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png" /><link href="https://sneakycode.net/manifest.json" rel="manifest" /><meta content="#ffffff" name="msapplication-TileColor" /><meta content="ms-icon-144x144.png" name="msapplication-TileImage" /><meta content="#ffffff" name="theme-color" /><meta content="SneakyCode" property="og:site_name" /><meta content="article" property="og:type" /><meta content="SignalR Hello World (That is not a chat app)" property="og:title" /><meta property="og:description" /><meta content="https://sneakycode.net/signalr-hello-world" property="og:url" /><meta content="csharp" property="article:tag" /><meta content="signalR" property="article:tag" /><meta content="javascript" property="article:tag" /><meta content="js" property="article:tag" /><meta content="asp.net" property="article:tag" /><link href="https://sneakycode.net/style.css" rel="stylesheet" /><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" /></head><body><nav class="navbar is-fixed-top is-dark has-gradient" role="navigation"><div class="navbar-brand"><a class="navbar-item has-text-weight-bold" href="https://sneakycode.net/">sneakycode</a></div></nav><nav aria-label="main navigation" class="navbar is-fixed-bottom is-dark has-gradient" role="navigation"><div class="navbar-brand"><a aria-label="home" class="navbar-item" href="https://sneakycode.net/"><span class="icon"><i class="fa fa-lg fa-bath"></i></span></a><a aria-label="history" class="navbar-item" href="https://sneakycode.net/all-posts"><span class="icon"><i class="fa fa-lg fa-history"></i></span></a><a aria-label="tags" class="navbar-item" href="https://sneakycode.net/tags"><span class="icon"><i class="fa fa-lg fa-tags"></i></span></a><a aria-label="rss" class="navbar-item" href="https://sneakycode.net/rss.rss"><span class="icon"><i class="fa fa-lg fa-rss"></i></span></a><a aria-label="github" class="navbar-item" href="https://github.com/sneakypeet" target="_blank"><span class="icon"><i class="fa fa-lg fa-github"></i></span></a><a aria-label="twitter " class="navbar-item" href="https://twitter.com/PieterKoornhof" target="_blank"><span class="icon"><i class="fa fa-lg fa-twitter"></i></span></a></div></nav><div class="section"><div class="container"><div class="columns is-8 is-variable is-desktop"><article class="column is-three-quarters-desktop"><h1 class="title has-text-weight-light">SignalR Hello World (That is not a chat app)</h1><p class="subtitle is-6 post-tags"><span class="tags"><span class="tag is-primary tag-lite">2015-01-07</span><a class="tag" href="https://sneakycode.net/tag/asp-net">asp.net</a><a class="tag" href="https://sneakycode.net/tag/csharp">csharp</a><a class="tag" href="https://sneakycode.net/tag/javascript">javascript</a><a class="tag" href="https://sneakycode.net/tag/js">js</a><a class="tag" href="https://sneakycode.net/tag/signalR">signalR</a></span></p><div class="has-text-justified content"><p>I have been wanting to try out SignalR for a while now and finally came up with an idea that is simple enough to start with (that is not a chat application).</p><p>I am not going to go into the details of how SignalR works, just show you the code to get started. If you have never heard about SignalR, read the first two paragraphs <a href="http://signalr.net/">here</a>.</p><p>Our app will do the following</p>
<ul>
  <li>The User navigates to a page on their desktop. We will display a QR code on the page</li>
  <li>The User will scan the QR code with their smart phone and get redirected to a page on their mobile browser</li>
  <li>The User will then see live orientation data of their phone on their desktop</li>
</ul><p>To keep the post short I am only going to show you the code relevant to SignalR. You can checkout the <a href="http://sneakysignal.azurewebsites.net/">demo</a> and the <a href="https://github.com/SneakyPeet/SneakySignal">source code</a> for the full details.</p><p><strong>Let's Get Started</strong></p><p>Open up Visual Studio and create a new <em>ASP.NET MVC 5</em> application.</p><p>Grab the following library via nuget</p>
<ul>
  <li>Microsoft ASP.NET Web SignalR</li>
</ul><p><strong>On The Server</strong></p><p>The first thing we need to do is hook-up SignalR to our app start-up. We do this by creating a file and adding the following code. When the app starts up the Configuration function will automatically get called. **Note: SneakySignal is the name of the project and has nothing to do with SignalR.*</p>
<pre class="syntax"><code class="csharp"><span></span><span class="k">using</span> <span class="nn">Microsoft.Owin</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Owin</span><span class="p">;</span>
<span class="na">[assembly: OwinStartup(typeof(SneakySignal.Startup))]</span>
<span class="k">namespace</span> <span class="nn">SneakySignal</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">Startup</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">Configuration</span><span class="p">(</span><span class="n">IAppBuilder</span> <span class="n">app</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">app</span><span class="p">.</span><span class="n">MapSignalR</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre><p>Next we need to add the code that will handle the communication between server and client. For now all you need to know is that SignalR uses the concept of hubs. You can read more about it <a href="http://www.asp.net/signalr/overview/guide-to-the-api">here</a>.</p><p>Create the MotionHub.cs class that inherits from Hub.</p>
<pre class="syntax"><code class="csharp"><span></span><span class="k">using</span> <span class="nn">Microsoft.AspNet.SignalR</span><span class="p">;</span>
<span class="k">namespace</span> <span class="nn">SneakySignal</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">MotionHub</span> <span class="p">:</span> <span class="n">Hub</span>
    <span class="p">{</span>
        <span class="c1">//Desktop and phone uses this to get their connection id</span>
        <span class="k">public</span> <span class="kt">string</span> <span class="nf">GetConnectionId</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">Context</span><span class="p">.</span><span class="n">ConnectionId</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">//Called by the phone</span>
        <span class="c1">//Tells the desktop that the phone wants to connect</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">ClientConnected</span><span class="p">(</span><span class="kt">string</span> <span class="n">connectionId</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">clientId</span> <span class="p">=</span> <span class="n">Context</span><span class="p">.</span><span class="n">ConnectionId</span><span class="p">;</span>
            <span class="n">Clients</span><span class="p">.</span><span class="n">Client</span><span class="p">(</span><span class="n">connectionId</span><span class="p">).</span><span class="n">clientConnected</span><span class="p">(</span><span class="n">clientId</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">//Called by the desktop</span>
        <span class="c1">//Tells the phone that it is connected and can start sending data</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">StartExecution</span><span class="p">(</span><span class="kt">string</span> <span class="n">connectionId</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Clients</span><span class="p">.</span><span class="n">Client</span><span class="p">(</span><span class="n">connectionId</span><span class="p">).</span><span class="n">startExecution</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="c1">//Called by the phone</span>
        <span class="c1">//Tells the desktop that the orientation has changed</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">OrientationChanged</span><span class="p">(</span><span class="kt">string</span> <span class="n">connectionId</span><span class="p">,</span> <span class="n">OrientationData</span> <span class="n">orientationData</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Clients</span><span class="p">.</span><span class="n">Client</span><span class="p">(</span><span class="n">connectionId</span><span class="p">).</span><span class="n">orientationChanged</span><span class="p">(</span><span class="n">orientationData</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">class</span> <span class="nc">OrientationData</span>
	<span class="p">{</span>
    	<span class="k">public</span> <span class="kt">decimal</span> <span class="n">Alpha</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    	<span class="k">public</span> <span class="kt">decimal</span> <span class="n">Beta</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    	<span class="k">public</span> <span class="kt">decimal</span> <span class="n">Gamma</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre><p>As you can see we only have to write the business logic specific to our app as SignalR handles all the connection management.</p><p>Last but not least add the following lines in your <code>_layout.cshtml</code> file.</p>
<pre class="syntax"><code class="bash"><span></span>/Scripts/jquery.signalR-2.1.2.min.js
/signalr/js
</code></pre><p><code>/signalr/js</code> is a convention used by SignalR. On build our MobileHub will generate some javascript that will be found on this route.</p><p>Now for the client side implementations.</p><p><strong>Desktop Client</strong> </p><pre class="syntax">  <code class="js"><span></span><span class="kd">var</span> <span class="nx">hub</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">connection</span><span class="p">.</span><span class="nx">motionHub</span><span class="p">;</span>
</code>  <code class="js"><span></span><span class="c1">// register mobile and tell it to start executing</span>
</code>  <code class="js"><span></span><span class="nx">hub</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">ClientConnected</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">clientId</span><span class="p">)</span> <span class="p">{</span>  <span class="nx">hub</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">startExecution</span><span class="p">(</span><span class="nx">clientConnectionId</span><span class="p">);</span>  <span class="p">};</span>
</code>  <code class="js"><span></span><span class="c1">// update orientation</span>
</code>  <code class="js"><span></span><span class="nx">hub</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">orientationChanged</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">orientation</span><span class="p">)</span> <span class="p">{};</span>
</code>  <code class="js"><span></span><span class="c1">// connect to server</span>
</code>  <code class="js"><span></span><span class="nx">$</span><span class="p">.</span><span class="nx">connection</span><span class="p">.</span><span class="nx">hub</span><span class="p">.</span><span class="nx">start</span><span class="p">().</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>  <span class="nx">hub</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">getConnectionId</span><span class="p">().</span><span class="nx">done</span><span class="p">(</span>  <span class="kd">function</span> <span class="p">(</span><span class="nx">desktopConnectionId</span><span class="p">)</span> <span class="p">{</span>  <span class="cm">/* show QR code with url containing desktop connection id */</span>  <span class="p">});</span>  <span class="p">})</span>
</code> </pre><p>The first thing you will see is that we get our specific hub from <code>$.connection.motionHub</code>. We then subscribe to the clientConnected and orientationChanged methods that we specified in our <code>MotionHub.cs</code> file.</p><p>The last thing is to connect to the server using $<code>.connection.hub.start()</code>. When we are connected to the server we ask it to provide us with our connection id.</p><p><strong>Mobile Client</strong> </p><pre class="syntax"> <code class="js"><span></span><span class="kd">var</span> <span class="nx">hub</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">connection</span><span class="p">.</span><span class="nx">motionHub</span><span class="p">;</span>
</code> <code class="js"><span></span><span class="nx">hub</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nx">StartExecution</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>  <span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">"deviceorientation"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">orientation</span><span class="p">){</span>  <span class="nx">hub</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">orientationChanged</span><span class="p">(</span><span class="nx">desktopConnectionId</span><span class="p">,</span> <span class="nx">orientation</span><span class="p">);</span>  <span class="p">});</span> <span class="p">};</span>
</code> <code class="js"><span></span><span class="c1">// connect to server</span>
</code> <code class="js"><span></span><span class="nx">$</span><span class="p">.</span><span class="nx">connection</span><span class="p">.</span><span class="nx">hub</span><span class="p">.</span><span class="nx">start</span><span class="p">().</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>  <span class="nx">hub</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">clientConnected</span><span class="p">(</span><span class="nx">desktopConnectionId</span><span class="p">).</span><span class="nx">done</span><span class="p">();</span> <span class="p">});</span>
</code> </pre><p>The javascript on the mobile side is very similar. First we subscribe to <code>startExecution</code>. In this method we add an event listener that listens for the <code>deviceorientation</code> event. On an event we call <code>orientationChanged</code> on the server with the new orientation.</p><p>All that is left is to connect to the server and tell the relevant desktop that we want to connect to it.</p><p><strong>note:</strong> I left out a lot of logic like event throttling etc. to keep it concise.*</p><p>To summarize what is actually happening have a look at the image below.</p><p><img src="https://farm8.staticflickr.com/7545/16034625040_89802f3c7c_o.png" alt="SignalR hello world program flow" _="_" /></p><p><strong>And thats it</strong></p><p>I was impressed by how simple it is to get something awesome done so easily. Obviously there is a lot more to SignalR and what you can do with it, but for a hello world this really turned out great. Jump over to the <a href="http://sneakysignal.azurewebsites.net/">demo</a> and have a look. ___ <em>This post was first published on <a href="http://blog.entelect.co.za/home">blog.entelect.co.za</a></em></p><p><a href="http://www.codeproject.com/script/Articles/BlogFeedList.aspx?amid=8804440" rel="tag" style="display:none">CodeProject</a></p></div></article><div aria-label="pagination" class="column" role="navigation"><div class="short-timeline"><div class="timeline is-rtl"><div class="timeline-header"><a class="tag is-primary tag-lite" href="https://sneakycode.net/git-good">Older</a></div><div class="timeline-item"><div class="timeline-marker"></div><div class="timeline-content"><a class="header" href="https://sneakycode.net/git-good">Git Good</a></div></div><div class="timeline-header"><a class="tag is-primary tag-lite" href="https://sneakycode.net/intro-to-practical-domain-driven-design">Newer</a></div><div class="timeline-item"><div class="timeline-marker"></div><div class="timeline-content"><a class="header" href="https://sneakycode.net/intro-to-practical-domain-driven-design">Introduction To Practical Domain Driven Design</a></div></div><div class="timeline-header"><a class="tag is-primary tag-lite" href="https://sneakycode.net/tag/csharp">csharp</a></div><div class="timeline-item"><div class="timeline-marker"></div><div class="timeline-content"><a class="header" href="https://sneakycode.net/quartz-job-tracking">Job Tracking using Quartz for .net</a></div></div><div class="timeline-header"><span class="tag is-primary tag-lite">end</span></div></div></div></div></div><div><div id="disqus_thread"></div><script>var disqus_config = function () {
           this.page.url = 'http://sneakycode.net/signalr-hello-world';
           // this.page.identifier = PAGE_IDENTIFIER;
         };
         (function() { // DON'T EDIT BELOW THIS LINE
           var d = document, s = d.createElement('script');
           s.src = 'https://sneakycode.disqus.com/embed.js';
           s.setAttribute('data-timestamp', +new Date());
           (d.head || d.body).appendChild(s);
         })();</script></div></div></div></body></html>