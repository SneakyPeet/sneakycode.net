<!DOCTYPE html>

<html></html><html class="has-navbar-fixed-top"><head><script async="async" src="https://www.googletagmanager.com/gtag/js?id=UA-58216004-1"></script><script>window.dataLayer = window.dataLayer || [];
                 function gtag(){dataLayer.push(arguments);}
                 gtag('js', new Date());
                 gtag('config', 'UA-58216004-1');</script><meta charset="utf-8" content="text/html" /><meta content="width=device-width, initial-scale=1" name="viewport" /><link href="https://sneakycode.net/modeling-with-aggregates" rel="canonnical" /><link href="https://sneakycode.net/rss/" rel="alternative" title="SneakyCode" type="application/rss+xml" /><title>Modeling with Aggregates</title><meta content="Pieter Koornhof" name="author" /><link href="https://sneakycode.net/apple-icon-57x57.png" rel="apple-touch-icon" sizes="57x57" /><link href="https://sneakycode.net/apple-icon-60x60.png" rel="apple-touch-icon" sizes="60x60" /><link href="https://sneakycode.net/apple-icon-72x72.png" rel="apple-touch-icon" sizes="72x72" /><link href="https://sneakycode.net/apple-icon-76x76.png" rel="apple-touch-icon" sizes="76x76" /><link href="https://sneakycode.net/apple-icon-114x114.png" rel="apple-touch-icon" sizes="114x114" /><link href="https://sneakycode.net/apple-icon-120x120.png" rel="apple-touch-icon" sizes="120x120" /><link href="https://sneakycode.net/apple-icon-144x144.png" rel="apple-touch-icon" sizes="144x144" /><link href="https://sneakycode.net/apple-icon-152x152.png" rel="apple-touch-icon" sizes="152x152" /><link href="https://sneakycode.net/apple-icon-180x180.png" rel="apple-touch-icon" sizes="180x180" /><link href="https://sneakycode.net/android-icon-192x192.png" rel="icon" sizes="192x192" type="image/png" /><link href="https://sneakycode.net/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png" /><link href="https://sneakycode.net/favicon-96x96.png" rel="icon" sizes="96x96" type="image/png" /><link href="https://sneakycode.net/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png" /><link href="https://sneakycode.net/manifest.json" rel="manifest" /><meta content="#ffffff" name="msapplication-TileColor" /><meta content="ms-icon-144x144.png" name="msapplication-TileImage" /><meta content="#ffffff" name="theme-color" /><meta content="SneakyCode" property="og:site_name" /><meta content="article" property="og:type" /><meta content="Modeling with Aggregates" property="og:title" /><meta property="og:description" /><meta content="https://sneakycode.net/modeling-with-aggregates" property="og:url" /><meta content="domain driven design" property="article:tag" /><meta content="ddd" property="article:tag" /><meta content="aggregates" property="article:tag" /><link href="https://sneakycode.net/style.css" rel="stylesheet" /><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" /></head><body><nav class="navbar is-fixed-top is-dark has-gradient" role="navigation"><div class="navbar-brand"><a class="navbar-item has-text-weight-bold" href="https://sneakycode.net/">sneakycode</a></div></nav><nav aria-label="main navigation" class="navbar is-fixed-bottom is-dark has-gradient" role="navigation"><div class="navbar-brand"><a aria-label="home" class="navbar-item" href="https://sneakycode.net/"><span class="icon"><i class="fa fa-lg fa-bath"></i></span></a><a aria-label="history" class="navbar-item" href="https://sneakycode.net/all-posts"><span class="icon"><i class="fa fa-lg fa-history"></i></span></a><a aria-label="tags" class="navbar-item" href="https://sneakycode.net/tags"><span class="icon"><i class="fa fa-lg fa-tags"></i></span></a><a aria-label="rss" class="navbar-item" href="https://sneakycode.net/rss.rss"><span class="icon"><i class="fa fa-lg fa-rss"></i></span></a><a aria-label="github" class="navbar-item" href="https://github.com/sneakypeet" target="_blank"><span class="icon"><i class="fa fa-lg fa-github"></i></span></a><a aria-label="twitter " class="navbar-item" href="https://twitter.com/PieterKoornhof" target="_blank"><span class="icon"><i class="fa fa-lg fa-twitter"></i></span></a></div></nav><div class="section"><div class="container"><div class="columns is-8 is-variable is-desktop"><article class="column is-three-quarters-desktop"><h1 class="title has-text-weight-light">Modeling with Aggregates</h1><p class="subtitle is-6 post-tags"><span class="tags"><span class="tag is-primary tag-lite">2015-03-12</span><a class="tag" href="https://sneakycode.net/tag/aggregates">aggregates</a><a class="tag" href="https://sneakycode.net/tag/ddd">ddd</a><a class="tag" href="https://sneakycode.net/tag/domain-driven-design">domain driven design</a></span></p><div class="has-text-justified content"><p>Modeling is at the heart of Domain Driven Design. It is also the reason that there are not many DDD examples out there. It is easy to give an example of an architecture like MVC as the different parts are very logical. But with DDD each solution is so tightly coupled to the domain and the problem that needs to be solved that simple examples rarely captures the essence of what a successful model might be. Learning how to model cannot just be taught in a blog post, or even a few. It is a learned skill that takes time, some might say years, to learn. You need to get your hands dirty. That said there are tools that you use with you modeling. Entities and value objects form part of these tools, but probably the most important one is the aggregate.</p><p><strong>So what is an Aggregate?</strong></p><p>Typical flow through the application layer (<a href="http://sneakycode.net/domain-driven-design-app-structure/">or api</a>) might look something like this: </p><p><img src="http://res.cloudinary.com/dltpyggxx/image/upload/v1426189853/Capture1_pobevv.png" alt="Typical DDD action flow" _="_" /></p><p>In some cases the <em>Does work on the domain</em> step might look as follows:</p><p><img src="http://res.cloudinary.com/dltpyggxx/image/upload/v1426189853/Capture2_wsiypi.png" alt="Typical DDD aggregate flow" _="_" /></p><p>What you need to understand is that aggregates are self-contained units that we work with to avoid messing up our code with a tangle of interconnected objects. Just like the application layer contains the application and provides access to it via clearly defined entry points, the aggregate contains all information that it needs and the methods to do the required work. Our entire domain centers on these aggregates. If we fail at aggregates, we fail at DDD.</p><p><strong>So how are they made and used?</strong></p><p>An aggregate is typically made as follows</p>
<ul>
  <li>The domain makes a new instance. Typically using a factory.</li>
  <li>The application layer asks a repository to build up an instance from existing data.</li>
</ul><p>and used as follows</p>
<ul>
  <li>Directly by the application layer.</li>
  <li>By some domain service when we need to work on multiple aggregates.</li>
</ul><p><strong>What does an Aggregate look like</strong></p><p>An aggregate is made up of two main parts namely a boundary and a root.</p><p><img src="http://res.cloudinary.com/dltpyggxx/image/upload/v1426190040/AR_gyjejd.png" alt="Domain Driven Design Aggregate" _="_" /> The boundary(B on the image) defines the contents of the aggregate. It is also the barrier between the aggregate contents and the rest of the application. Nothing outside the boundary can keep a reference to anything inside the boundary. </p><p>The Aggregate Root (AR on the image) provides access to the aggregate contents. It is the only object in the aggregate that objects outside the aggregate may hold a reference to. The aggregate root in turn holds references to the aggregate contents. Although I said it provides access to the contents, it is not direct access. We will not ask the root for an object and then do work on the object. We would ask the aggregate to do the work on the object for us. In-fact we might be oblivious of the objects existence. The contents of an aggregate is made up of our basic DDD building blocks. Entities, Value Objects and other Aggregates. </p><p><strong>Can Haz Example?</strong></p><p>The best way to give an example of an aggregate is by using the invoice analogy. </p><p>Our example aggregate is made up of the following:</p>
<ul>
  <li>An Invoice</li>
  <li>A List of Invoice Lines</li>
  <li>A Customer</li>
  <li>A Billing Address</li>
</ul><p>It is fairly straight forward to identify the root. It is the Invoice. The invoice will keep references to it's invoice lines and to the customer the invoice is for. The application in turn will only keep a reference to the invoice. If we want to add or remove invoice lines, we ask the invoice to do so. If we want to update the billing address we ask the invoice. The invoice in turn asks the customer to update it's billing address. In this case the customer is also an aggregate root. The invoice, invoice lines and customer will all typically be Entities. </p><p><strong>So what is the point?</strong></p><p>To build a rich domain. The goal is to clearly define logical self-contained pieces of work. By clearly defining the boundaries and roots, we directly limit cross cutting dependencies and thus prevent a ball of spaghetti. We force ourselves to get all the information we need upfront, and then do the work we want. We force the lowest level objects to be responsible for their behavior. This makes it easy for us to find behavior as we know where to look for it. This helps us to limit duplicate code. It also makes testing a breeze as we move all our behavior to the center of our application. There are no outward dependencies so mocking is rarely needed and it is easy to maintain close to a 100% code coverage.</p>
<hr /><p>The invoice model is straight forward, but you will probably find that most aggregates are not as easily defined. We should model our aggregates in a way that clearly represents the problem domain and we should use the ubiquitous language shared by developers and domain experts to make their purpose clear. But this can be really really hard, but is really really worth it. </p><p>Practice really makes perfect. If you can find someone that knows how to do model properly and is willing to teach you, it is even better.</p><p>More on aggregates soon ;)</p><p><a href="http://www.codeproject.com/script/Articles/BlogFeedList.aspx?amid=8804440" rel="tag" style="display:none">CodeProject</a></p></div></article><div aria-label="pagination" class="column" role="navigation"><div class="short-timeline"><div class="timeline is-rtl"><div class="timeline-header"><a class="tag is-primary tag-lite" href="https://sneakycode.net/quartz-job-tracking">Older</a></div><div class="timeline-item"><div class="timeline-marker"></div><div class="timeline-content"><a class="header" href="https://sneakycode.net/quartz-job-tracking">Job Tracking using Quartz for .net</a></div></div><div class="timeline-header"><a class="tag is-primary tag-lite" href="https://sneakycode.net/getting-wooed-by-fsharp">Newer</a></div><div class="timeline-item"><div class="timeline-marker"></div><div class="timeline-content"><a class="header" href="https://sneakycode.net/getting-wooed-by-fsharp">Getting wooed by F#</a></div></div><div class="timeline-header"><a class="tag is-primary tag-lite" href="https://sneakycode.net/tag/ddd">ddd</a></div><div class="timeline-item"><div class="timeline-marker"></div><div class="timeline-content"><a class="header" href="https://sneakycode.net/what-language-does-your-application-speak">What Language Does Your Application Speak</a></div></div><div class="timeline-item"><div class="timeline-marker"></div><div class="timeline-content"><a class="header" href="https://sneakycode.net/reflecting-on-domain-driven-design">Reflecting on Domain Driven Design</a></div></div><div class="timeline-item"><div class="timeline-marker"></div><div class="timeline-content"><a class="header" href="https://sneakycode.net/anemia-induced-memory-loss">Anemia induced memory loss</a></div></div><div class="timeline-item"><div class="timeline-marker"></div><div class="timeline-content"><a class="header" href="https://sneakycode.net/aggregates-and-persistence">Aggregates and Persistence</a></div></div><div class="timeline-item"><div class="timeline-marker"></div><div class="timeline-content"><a class="header" href="https://sneakycode.net/getting-wooed-by-fsharp">Getting wooed by F#</a></div></div><div class="timeline-item"><div class="timeline-marker"></div><div class="timeline-content"><a class="header" href="https://sneakycode.net/make-those-value-objects-work-for-you">Make Those Value Objects Work For You</a></div></div><div class="timeline-item"><div class="timeline-marker"></div><div class="timeline-content"><a class="header" href="https://sneakycode.net/value-objects">Value Objects</a></div></div><div class="timeline-item"><div class="timeline-marker"></div><div class="timeline-content"><a class="header" href="https://sneakycode.net/domain-driven-design-app-structure-part-2">Domain Driven Design App Structure part 2</a></div></div><div class="timeline-item"><div class="timeline-marker"></div><div class="timeline-content"><a class="header" href="https://sneakycode.net/domain-driven-design-app-structure">Domain Driven Design App Structure</a></div></div><div class="timeline-item"><div class="timeline-marker"></div><div class="timeline-content"><a class="header" href="https://sneakycode.net/intro-to-practical-domain-driven-design">Introduction To Practical Domain Driven Design</a></div></div><div class="timeline-header"><a class="tag is-primary tag-lite" href="https://sneakycode.net/tag/aggregates">aggregates</a></div><div class="timeline-item"><div class="timeline-marker"></div><div class="timeline-content"><a class="header" href="https://sneakycode.net/anemia-induced-memory-loss">Anemia induced memory loss</a></div></div><div class="timeline-item"><div class="timeline-marker"></div><div class="timeline-content"><a class="header" href="https://sneakycode.net/aggregates-and-persistence">Aggregates and Persistence</a></div></div><div class="timeline-header"><span class="tag is-primary tag-lite">end</span></div></div></div></div></div><div><div id="disqus_thread"></div><script>var disqus_config = function () {
           this.page.url = 'http://sneakycode.net/modeling-with-aggregates';
           // this.page.identifier = PAGE_IDENTIFIER;
         };
         (function() { // DON'T EDIT BELOW THIS LINE
           var d = document, s = d.createElement('script');
           s.src = 'https://sneakycode.disqus.com/embed.js';
           s.setAttribute('data-timestamp', +new Date());
           (d.head || d.body).appendChild(s);
         })();</script></div></div></div></body></html>